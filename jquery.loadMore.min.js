;(function($,g,h,i){'use strict';if(typeof jQuery==='undefined'){throw new Error('scrollLoad 依赖于jQeruy,请先引 jQuery 再使用.');}
    var j=getPath();$.fn.loadMore=function(d){var e,opts,contentH,viewH,scrollTopH,running=false,DEFAULTS={loadType:'auto',ajaxSwitch:true,url:'',data:{},type:'get',success:function(){},error:function(){},callback:function(){},async:true,dataType:'json',conLocation:"",scrollBottom:100,imgLoading:$("<div class='_loadMore-imgLoading'><img src='"+j+"images/load.gif'><span class='loadText'>正在加载,请稍后...</span></div>"),clickLoading:$('<div class="_loadMore-click"><span>点击加载更多</span></div>')};function Load(){this.init=function(a){opts=$.extend({},DEFAULTS,d);if(opts.conLocation){opts.conLocation=$(opts.conLocation)}else if(a[0]===h||a[0]===g){opts.conLocation=$("body");e=$(h)}else{opts.conLocation=a;e=a}
        this.startTime=+new Date();var b=this;if(!opts.ajaxSwitch){e.on('scroll',function(){b.throttle(b.noAjax,50)});return}
        if(opts.loadType==='auto'){opts.conLocation.css('padding-bottom','50px');e.on('scroll',function(){b.throttle(b.autoLoad,50)})}else{opts.clickLoading.on('click',function(){b.handleClick()});opts.conLocation.append(opts.clickLoading)}
        var c=$('<link href="'+j+'jquery.loadMore.css" rel="stylesheet">');$('head').append(c)}}
        Load.prototype={autoLoad:function(){if(opts.ajaxSwitch===true&&running===false){this.countHeight();var a=contentH-viewH-scrollTopH;if(a<=opts.scrollBottom){opts.imgLoading&&opts.conLocation.append(opts.imgLoading);e.scrollTop(scrollTopH-opts.scrollBottom-3);this.getData()}}},handleClick:function(){if(!running){this.getData();$("._loadMore-click").hide();opts.conLocation.append(opts.imgLoading)}},noAjax:function(){this.countHeight();if(running=false&&contentH-viewH-scrollTopH<=opts.scrollBottom){running=true;opts.callback();running=false}},getData:function(){running=true;var b=this;$.ajax({url:opts.url,async:opts.async,data:opts.data,type:opts.type,dataType:opts.dataType,success:function(a){opts.success(a);b.loadingOperation()},error:function(a){b.loadingOperation();opts.error&&opts.error(a)}})},countHeight:function(){if(e[0]===h||e[0]===g){contentH=$(h).innerHeight();viewH=$(g).innerHeight();scrollTopH=$(h).scrollTop()}else{contentH=e.get(0).scrollHeight;viewH=e.innerHeight();scrollTopH=e.scrollTop()}},loadingOperation:function(){running=false;$('._loadMore-imgLoading').remove();if(opts.loadType==='click'){opts.conLocation.append(opts.clickLoading);opts.clickLoading.show()}},throttle:function(a,b){var c=+new Date();if(c-this.startTime>=b){this.startTime=c;a.call(this)}
            if(contentH-viewH-scrollTopH<20&&opts.loadType==='auto'){e.scrollTop(scrollTopH-opts.scrollBottom-20)}},updatePram:function(a,b){opts[a]=b}};var f=new Load();f.init(this);return{updatePram:f.updatePram}};function getPath(){var a=h.scripts,b=a[a.length-1].src;return b.substring(0,b.lastIndexOf("/")+1)}})(jQuery,window,document,undefined);
