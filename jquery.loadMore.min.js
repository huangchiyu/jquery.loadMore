;(function($,i,j,k){'use strict';if(typeof jQuery==='undefined'){throw new Error('scrollLoad 依赖于jQeruy,请先引 jQuery 再使用.');}
var l=getPath();$.fn.loadMore=function(d){var e=$("<div class='_loadMore-imgLoading'><img src='"+l+"images/load.gif'><span class='loadText'>正在加载,请稍后...</span></div>");var f=$('<div class="_loadMore-click"><span>点击加载更多</span></div>');var g,opts,contentH,viewH,scrollTopH,running=false,DEFAULTS={loadType:'auto',ajaxSwitch:true,url:'',data:{},type:'get',success:function(){},error:function(){},callback:function(){},async:true,dataType:'json',conLocation:"",scrollBottom:100,imgLoading:e,clickLoading:f,};function Load(){this.init=function(a){opts=$.extend({},DEFAULTS,d);if(opts.conLocation){opts.conLocation=$(opts.conLocation)}else if(a[0]===j||a[0]===i){opts.conLocation=$("body");g=$(j)}else{opts.conLocation=a;g=a}
this.startTime=+new Date();var b=this;if(!opts.ajaxSwitch){g.on('scroll',function(){b.throttle(b.noAjax,50)});return}
if(opts.loadType==='auto'){opts.conLocation.css('padding-bottom','50px');g.on('scroll',function(){b.throttle(b.autoLoad,50)})}else{opts.clickLoading.on('click',function(){b.handleClick()});opts.conLocation.append(opts.clickLoading)}
var c=$('<link href="'+l+'jquery.loadMore.css" rel="stylesheet">');$('head').append(c)}}
Load.prototype={autoLoad:function(){if(opts.ajaxSwitch===true&&running===false){this.countHeight();var a=contentH-viewH-scrollTopH;if(a<=opts.scrollBottom){opts.imgLoading&&opts.conLocation.append(opts.imgLoading);g.scrollTop(scrollTopH-opts.scrollBottom-3);this.getData()}}},handleClick:function(){if(!running){this.getData();$("._loadMore-click").hide();opts.conLocation.append(opts.imgLoading)}},noAjax:function(){this.countHeight();if(running=false&&contentH-viewH-scrollTopH<=opts.scrollBottom){running=true;opts.callback();running=false}},getData:function(){running=true;var b=this;$.ajax({url:opts.url,async:opts.async,data:opts.data,type:opts.type,dataType:opts.dataType,success:function(a){opts.success(a);b.loadingOperation()},error:function(a){b.loadingOperation();opts.error&&opts.error(a)}})},countHeight:function(){if(g[0]===j||g[0]===i){contentH=$(j).innerHeight();viewH=$(i).innerHeight();scrollTopH=$(j).scrollTop()}else{contentH=g.get(0).scrollHeight;viewH=g.innerHeight();scrollTopH=g.scrollTop()}},loadingOperation:function(){running=false;$('._loadMore-imgLoading').remove();if(opts.loadType==='click'){opts.conLocation.append(opts.clickLoading);opts.clickLoading.show()}},throttle:function(a,b){var c=+new Date();if(c-this.startTime>=b){this.startTime=c;a.call(this)}
if(contentH-viewH-scrollTopH<20&&opts.loadType==='auto'){g.scrollTop(scrollTopH-opts.scrollBottom-20)}},updatePram:function(a,b){opts[a]=b}};var h=new Load();h.init(this);return{updatePram:h.updatePram}};function getPath(){var a=j.scripts,b=a[a.length-1].src;return b.substring(0,b.lastIndexOf("/")+1)}})(jQuery,window,document,undefined);